import { AppLayout } from "@/components/AppLayout";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";

type TaskStatus = "done" | "in-progress" | "not-started";

interface TimelineTask {
  id: string;
  status: TaskStatus;
  deadline: string;
  title: string;
  description: string;
  buttonText: string;
  buttonDisabled?: boolean;
}

const tasks: TimelineTask[] = [
  {
    id: "1",
    status: "done",
    deadline: "期日：2025-12-01 23:59",
    title: "各タスクの期日設定",
    description: "サイクルの準備をしてください。",
    buttonText: "設定する",
  },
  {
    id: "2",
    status: "in-progress",
    deadline: "期日：2025-12-01 23:59",
    title: "被評価者の設定",
    description: "評価の対象となる従業員を設定してください。",
    buttonText: "設定する",
  },
  {
    id: "3",
    status: "not-started",
    deadline: "期日：2025-12-01 23:59",
    title: "評価者選定依頼",
    description: "被評価者が自分の評価者（上司・同僚）を選定します。管理者は、被評価者へ評価者選定依頼を送信してください。",
    buttonText: "依頼準備をする",
    buttonDisabled: true,
  },
  {
    id: "4",
    status: "not-started",
    deadline: "期日：2025-12-16 00:00 〜 2025-12-18 23:59",
    title: "評価者選定状況の確認",
    description: "評価者選定の進捗を確認します。管理者は、期日までに全員の回答が完了していることを確認してください。",
    buttonText: "確認する",
    buttonDisabled: true,
  },
  {
    id: "5",
    status: "not-started",
    deadline: "期日：2025-12-01 23:59",
    title: "マネージャーによる選定内容の承認",
    description: "マネージャーが被評価者の評価者を承認します。管理者は、マネージャーへ承認依頼を送信してください。",
    buttonText: "依頼準備をする",
    buttonDisabled: true,
  },
  {
    id: "6",
    status: "not-started",
    deadline: "期日：2025-12-16 00:00 〜 2025-12-18 23:59",
    title: "マネージャー承認状況の確認",
    description: "評価者承認の進捗を確認します。管理者は、期日までに全マネージャーの回答が完了していることを確認してください。",
    buttonText: "確認する",
    buttonDisabled: true,
  },
  {
    id: "7",
    status: "not-started",
    deadline: "期日：2025-12-01 23:59",
    title: "360度評価フォームの公開",
    description: "360度評価の回答を開始します。管理者は、評価項目に不備がないか確認し、フォームを公開してください。",
    buttonText: "公開準備をする",
    buttonDisabled: true,
  },
  {
    id: "8",
    status: "not-started",
    deadline: "期日：2025-12-16 00:00 〜 2025-12-18 23:59",
    title: "回答状況の確認",
    description: "評価フォームの回答状況を確認します。管理者は、期日までに全員の回答が完了していることを確認してください。",
    buttonText: "確認する",
    buttonDisabled: true,
  },
  {
    id: "9",
    status: "not-started",
    deadline: "期日：2025-12-01 23:59",
    title: "スコア集計",
    description: "評価結果を集計します。",
    buttonText: "集計する",
    buttonDisabled: true,
  },
  {
    id: "10",
    status: "not-started",
    deadline: "期日：2025-12-01 23:59",
    title: "スコア妥当性チェック",
    description: "集計結果を確認し、異常値や入力ミスがないかを確認します。管理者は、必要に応じて修正を行ってください。",
    buttonText: "確認する",
    buttonDisabled: true,
  },
  {
    id: "11",
    status: "not-started",
    deadline: "期日：2025-12-01 23:59",
    title: "スコア公開",
    description: "被評価者へ最終スコアを公開します。",
    buttonText: "公開準備をする",
    buttonDisabled: true,
  },
];

function StatusBadge({ status }: { status: TaskStatus }) {
  if (status === "done") {
    return (
      <div className="flex items-center gap-1.5 rounded-full bg-blue-600 px-3 py-1 text-sm font-semibold leading-5 text-white">
        <svg className="h-[15px] w-[15px]" viewBox="0 0 15 15" fill="none">
          <path
            d="M7.18555 0C11.1542 5.50877e-06 14.3711 3.21687 14.3711 7.18555C14.3711 11.1542 11.1542 14.3711 7.18555 14.3711C3.21687 14.3711 5.50895e-06 11.1542 0 7.18555C0 3.21686 3.21686 0 7.18555 0ZM7.18555 1.24609C3.90549 1.24609 1.24609 3.90549 1.24609 7.18555C1.2461 10.4656 3.9055 13.125 7.18555 13.125C10.4656 13.125 13.125 10.4656 13.125 7.18555C13.125 3.9055 10.4656 1.2461 7.18555 1.24609ZM9.21289 4.92676C9.52589 4.67119 9.98842 4.69057 10.2803 4.98242C10.591 5.29361 10.5912 5.79733 10.2803 6.1084L6.71777 9.67188C6.42599 9.96331 5.96423 9.98081 5.65137 9.72559L5.59082 9.67188V9.6709H5.58984C5.5877 9.66876 5.59039 9.67049 5.58789 9.66797L5.58496 9.66504H5.58398L5.58301 9.66406C5.57783 9.65887 5.5852 9.6643 5.5791 9.6582C5.56702 9.64612 5.58376 9.66481 5.57129 9.65234L5.56934 9.65039C5.56777 9.64879 5.5691 9.64918 5.56738 9.64746L5.54297 9.62305C5.51084 9.59092 5.56248 9.64353 5.53027 9.61133L5.52832 9.60938L5.52734 9.60742L5.52539 9.60547L5.52344 9.60449L5.50195 9.58301C5.49573 9.57678 5.49286 9.57296 5.48633 9.56641L5.43066 9.51074L5.37695 9.45801C5.36701 9.44805 5.37637 9.45644 5.36621 9.44629L5.31738 9.39746C5.30426 9.38435 5.27969 9.36074 5.26562 9.34668C5.26088 9.34193 5.26357 9.34365 5.25879 9.33887C5.25775 9.33798 5.25682 9.3369 5.25586 9.33594L5.25195 9.33301C5.23635 9.31741 5.25453 9.33462 5.23926 9.31934C5.2162 9.29628 5.24722 9.32826 5.22461 9.30566C5.21728 9.29833 5.2181 9.29821 5.21094 9.29102L5.13379 9.21387C5.13252 9.2126 5.13018 9.21123 5.12891 9.20996L5.09082 9.17188C5.08551 9.16656 5.08824 9.16832 5.08301 9.16309C5.07786 9.15798 5.08032 9.16135 5.0752 9.15625C5.04022 9.12128 5.09442 9.17449 5.05957 9.13965C5.04933 9.1294 5.0532 9.13426 5.04297 9.12402C5.04165 9.12268 5.0404 9.12047 5.03906 9.11914C5.03776 9.11796 5.03639 9.11647 5.03516 9.11523L4.95215 9.0332C4.94657 9.02761 4.94997 9.03006 4.94434 9.02441C4.94296 9.02304 4.94083 9.02188 4.93945 9.02051C4.93814 9.01915 4.93688 9.01696 4.93555 9.01562C4.92351 9.0036 4.93934 9.0204 4.92676 9.00781C4.90356 8.98461 4.93331 9.01339 4.91016 8.99023L4.90625 8.98535C4.90496 8.98407 4.90271 8.98366 4.90137 8.98242C4.9 8.98105 4.89883 8.97891 4.89746 8.97754L4.88867 8.96875L4.88379 8.96484L4.87598 8.95508C4.86617 8.94527 4.87623 8.95728 4.86621 8.94727C4.86394 8.94497 4.86069 8.94083 4.8584 8.93848C4.85347 8.93355 4.82706 8.90812 4.82227 8.90332C4.8105 8.89155 4.79998 8.87908 4.78809 8.86719C4.75601 8.83511 4.80092 8.88197 4.76953 8.85059L4.66016 8.74121C4.64254 8.72359 4.66035 8.73945 4.64258 8.72168L4.59668 8.67578C4.59516 8.67429 4.59234 8.67337 4.59082 8.67188L4.56836 8.64844C4.55298 8.63306 4.5649 8.64499 4.5498 8.62988C4.52959 8.60967 4.55059 8.63165 4.53027 8.61133C4.48924 8.57029 4.53551 8.61461 4.49414 8.57324L4.45605 8.53613C4.42442 8.5045 4.41254 8.4936 4.38086 8.46191C4.37938 8.46036 4.37844 8.45754 4.37695 8.45605L4.36328 8.44238C4.3561 8.4352 4.35088 8.43191 4.34375 8.4248C4.3401 8.42115 4.32884 8.40892 4.3252 8.40527C4.319 8.39909 4.31184 8.3929 4.30566 8.38672L4.2832 8.36426C4.28165 8.36271 4.27987 8.35995 4.27832 8.3584L4.26953 8.34961C4.25818 8.33826 4.26136 8.34241 4.25 8.33105L4.21387 8.29492C4.21107 8.29212 4.2069 8.28698 4.2041 8.28418L4.11328 8.19238C4.10703 8.18613 4.10984 8.1909 4.10352 8.18457L4.01367 8.09473C4.00874 8.08976 3.98458 8.06469 3.97949 8.05957L3.97461 8.05469C3.97324 8.05332 3.9711 8.05215 3.96973 8.05078L3.96582 8.0459L3.87598 7.95605C3.86078 7.94086 3.85693 7.93799 3.8418 7.92285C3.8405 7.92154 3.83919 7.91927 3.83789 7.91797C3.83659 7.91679 3.8352 7.91527 3.83398 7.91406L3.81348 7.89453C3.81218 7.89323 3.81087 7.89095 3.80957 7.88965C3.49867 7.57847 3.49859 7.07382 3.80957 6.7627C4.12061 6.45196 4.62439 6.45214 4.93555 6.7627L4.97754 6.80371L4.99414 6.82031C4.99549 6.82166 4.99671 6.82384 4.99805 6.8252L5.0498 6.87598C5.05109 6.87726 5.05237 6.87864 5.05371 6.87988C5.05508 6.88125 5.05625 6.8834 5.05762 6.88477L5.0625 6.88867C5.06447 6.89064 5.0693 6.89549 5.07129 6.89746C5.08449 6.91066 5.07485 6.902 5.08789 6.91504C5.0986 6.92574 5.09563 6.9218 5.10645 6.93262C5.12996 6.95614 5.11688 6.94402 5.14062 6.96777L5.21289 7.03906L5.34082 7.16699L5.38184 7.20898C5.38338 7.21048 5.38619 7.21139 5.3877 7.21289C5.41224 7.23743 5.37179 7.19796 5.39648 7.22266C5.40576 7.23194 5.42423 7.2504 5.43359 7.25977L5.48438 7.31152C5.48593 7.31303 5.48872 7.31392 5.49023 7.31543L5.49902 7.3252C5.50053 7.32674 5.5024 7.32856 5.50391 7.33008L5.56836 7.39551C5.56992 7.39707 5.57266 7.39883 5.57422 7.40039L5.58301 7.40918C5.58762 7.41379 5.59693 7.42408 5.60156 7.42871L5.61035 7.4375C5.61162 7.43877 5.61963 7.44486 5.62109 7.44629C5.64035 7.46555 5.61976 7.4469 5.63867 7.46582L5.65723 7.48438C5.67242 7.49957 5.66166 7.48783 5.67676 7.50293L5.68164 7.50684C5.68314 7.50835 5.68405 7.51116 5.68555 7.5127L5.72266 7.54883L5.75977 7.58594C5.7613 7.58747 5.76311 7.59026 5.76465 7.5918L5.89648 7.72363C5.89893 7.72602 5.90292 7.72912 5.90527 7.73145L5.91504 7.74023C5.92692 7.75212 5.93746 7.7646 5.94922 7.77637C5.96332 7.79047 5.97141 7.79758 5.98535 7.81152C5.98764 7.81388 5.99089 7.81802 5.99316 7.82031L5.99805 7.8252C5.99939 7.82646 6.00163 7.82682 6.00293 7.82812C6.02431 7.84951 5.98956 7.81671 6.01074 7.83789L6.01562 7.8418L6.03711 7.86328C6.04178 7.86795 6.04911 7.87625 6.05371 7.88086C6.0696 7.89675 6.05554 7.88171 6.07129 7.89746C6.08721 7.91339 6.07202 7.89819 6.08789 7.91406L6.1084 7.93555C6.10974 7.93689 6.11194 7.93812 6.11328 7.93945C6.11455 7.94074 6.11594 7.94205 6.11719 7.94336C6.11854 7.94472 6.12072 7.94591 6.12207 7.94727L6.15332 7.98047L9.15332 4.98242L9.21289 4.92676Z"
            fill="white"
          />
        </svg>
        完了
      </div>
    );
  }

  if (status === "in-progress") {
    return (
      <div className="flex items-center gap-1 rounded-full border-2 border-blue-600 bg-white px-2.5 py-1 text-sm font-semibold leading-5 text-blue-600">
        <svg className="h-[15px] w-[15px]" viewBox="0 0 15 15" fill="none">
          <path
            d="M7.18555 0C11.1542 5.50877e-06 14.3711 3.21687 14.3711 7.18555C14.3711 11.1542 11.1542 14.3711 7.18555 14.3711C3.21687 14.3711 5.50895e-06 11.1542 0 7.18555C0 3.21686 3.21686 0 7.18555 0ZM7.18555 1.24609C3.90549 1.24609 1.24609 3.90549 1.24609 7.18555C1.2461 10.4656 3.9055 13.125 7.18555 13.125C10.4656 13.125 13.125 10.4656 13.125 7.18555C13.125 3.9055 10.4656 1.2461 7.18555 1.24609Z"
            fill="#2563EB"
          />
        </svg>
        進行中
      </div>
    );
  }

  return (
    <div className="flex items-center gap-1 rounded-full bg-gray-200 px-2.5 py-1 text-sm font-medium leading-5 text-gray-600">
      <svg className="h-[15px] w-[15px]" viewBox="0 0 15 15" fill="none">
        <g clipPath="url(#clip0)">
          <path
            d="M9.21675 13.1137C9.51203 13.1169 9.77476 13.3272 9.83305 13.6284C9.89959 13.9726 9.67379 14.3058 9.32957 14.3724L8.99951 14.4283C8.22611 14.5399 7.43822 14.5212 6.66951 14.3724C6.32549 14.3056 6.10042 13.9725 6.16696 13.6284C6.23357 13.2842 6.56678 13.0593 6.91099 13.1258C7.63013 13.265 8.36988 13.265 9.08902 13.1258L9.21675 13.1137ZM12.826 10.615C13.0373 10.4085 13.3719 10.372 13.6259 10.5441C13.9161 10.7408 13.9914 11.1359 13.7947 11.4261L13.5998 11.6993C13.1295 12.3263 12.5566 12.8704 11.9048 13.3086L11.792 13.3692C11.5188 13.4816 11.1949 13.3908 11.0237 13.1361C10.8283 12.8451 10.9062 12.4506 11.1971 12.255L11.4218 12.0965C11.9364 11.7135 12.3833 11.2459 12.7439 10.7138L12.826 10.615ZM3.24397 10.697C3.60259 11.2305 4.0482 11.6994 4.56141 12.0844L4.78611 12.2438L4.88495 12.3259C5.09123 12.5372 5.12697 12.8718 4.95487 13.1258C4.78268 13.3795 4.45919 13.4694 4.1866 13.3561L4.07378 13.2946L3.79966 13.0997C3.17275 12.6295 2.62846 12.0564 2.19039 11.4047L2.71718 11.0513L3.24397 10.697ZM2.36288 10.5236C2.65389 10.328 3.04836 10.406 3.24397 10.697L2.19039 11.4047C1.99508 11.1137 2.07208 10.7192 2.36288 10.5236ZM1.87152 5.66691C2.2156 5.7336 2.44054 6.06681 2.37407 6.41094C2.23489 7.13007 2.23489 7.8698 2.37407 8.58894C2.44043 8.93301 2.21556 9.2663 1.87152 9.33296C1.52725 9.39959 1.19411 9.17375 1.12748 8.82949C0.957524 7.95108 0.957488 7.04786 1.12748 6.16945C1.19431 5.82544 1.5274 5.60031 1.87152 5.66691ZM14.8725 6.16945C15.0425 7.04783 15.0425 7.9511 14.8725 8.82949L14.8352 8.95256C14.7223 9.22548 14.4298 9.39113 14.1285 9.33296C13.7843 9.26636 13.5595 8.93309 13.6259 8.58894L13.6716 8.31762C13.7629 7.68469 13.7477 7.04003 13.6259 6.41094L14.2488 6.29066L14.8725 6.16945ZM14.1285 5.66691C14.4725 5.60046 14.8058 5.82548 14.8725 6.16945L13.6259 6.41094C13.5594 6.06672 13.7843 5.73352 14.1285 5.66691ZM11.0442 1.87405C11.2163 1.62013 11.5398 1.53065 11.8125 1.64376L11.9262 1.70436L12.1994 1.90016C12.7368 2.30324 13.2137 2.78126 13.6148 3.32015L13.8087 3.59426L13.8693 3.70801C13.9816 3.98114 13.8908 4.30415 13.6362 4.47535C13.3815 4.64655 13.0477 4.60892 12.8372 4.40169L12.7551 4.30286L12.5966 4.07816C12.2682 3.63693 11.8777 3.24552 11.4377 2.9155L11.2139 2.75607L11.1151 2.67309C10.9089 2.46179 10.8722 2.12799 11.0442 1.87405ZM4.20804 1.62977C4.48101 1.51763 4.80416 1.60859 4.97539 1.86286C5.14652 2.11747 5.10874 2.45136 4.90173 2.6619L4.8029 2.74395C4.19314 3.15381 3.66821 3.67785 3.25609 4.28608C3.05938 4.57629 2.66432 4.65151 2.37407 4.45484C2.08404 4.25816 2.00797 3.86394 2.20437 3.57375C2.70779 2.83078 3.34947 2.19105 4.09429 1.69038L4.20804 1.62977ZM6.91099 1.87405C6.56687 1.94053 6.23365 1.71559 6.16696 1.37151C6.10036 1.0274 6.32549 0.694303 6.66951 0.627482L6.91099 1.87405ZM6.66951 0.627482C7.54792 0.457488 8.45115 0.457524 9.32957 0.627482C9.67383 0.694105 9.89967 1.02725 9.83305 1.37151C9.76638 1.71555 9.43309 1.94042 9.08902 1.87405C8.36988 1.73488 7.63013 1.73488 6.91099 1.87405L6.79072 1.2503L6.66951 0.627482Z"
            fill="#71717A"
          />
        </g>
        <defs>
          <clipPath id="clip0">
            <rect width="15" height="15" fill="white" />
          </clipPath>
        </defs>
      </svg>
      未着手
    </div>
  );
}

function TimelineConnector({
  status,
  isFirst,
  isLast,
}: {
  status: TaskStatus;
  isFirst?: boolean;
  isLast?: boolean;
}) {
  const lineColor = status === "done" || status === "in-progress" ? "bg-blue-600" : "bg-gray-300";

  return (
    <div className="flex flex-col items-center gap-2">
      {!isFirst && (
        <div
          className={`h-7 w-1 rounded-full ${status === "done" ? "bg-blue-600" : "bg-gray-300"}`}
        />
      )}
      <StatusBadge status={status} />
      {!isLast && (
        <div className={`min-h-[76px] w-1 flex-1 rounded-full ${lineColor}`} />
      )}
    </div>
  );
}

function TimelineItem({
  task,
  isFirst,
  isLast,
}: {
  task: TimelineTask;
  isFirst?: boolean;
  isLast?: boolean;
}) {
  const bgClass = task.status === "in-progress" ? "bg-white" : "bg-gray-50";
  const textColorClass = task.status === "in-progress" ? "text-foreground" : "text-muted-foreground";
  const titleColorClass = task.status === "in-progress" ? "text-card-foreground" : "text-muted-foreground";

  return (
    <div className="flex items-center gap-[15px]">
      <div className="hidden md:block">
        <TimelineConnector status={task.status} isFirst={isFirst} isLast={isLast} />
      </div>

      <div className="flex-1 pt-4">
        <div className={`flex min-w-[85px] flex-col gap-5 rounded-lg border border-border p-5 md:flex-row md:items-end ${bgClass}`}>
          <div className="flex flex-1 flex-col justify-center gap-1.5">
            <div className="md:hidden">
              <StatusBadge status={task.status} />
            </div>

            <Badge className="w-fit rounded-full bg-green-50 px-3 py-1 text-sm font-medium leading-5 text-teal-600 hover:bg-green-50">
              {task.deadline}
            </Badge>

            <div className="flex flex-col gap-1">
              <h3 className={`text-base font-bold leading-6 md:text-lg md:leading-7 ${titleColorClass}`}>
                {task.title}
              </h3>
              <p className={`text-sm leading-5 md:text-base md:leading-6 ${textColorClass}`}>
                {task.description}
              </p>
            </div>
          </div>

          <Button variant="outline" disabled={task.buttonDisabled} className="text-xs md:text-sm">
            {task.buttonText}
          </Button>
        </div>
      </div>
    </div>
  );
}

export default function EvaluationFlow() {
  return (
    <AppLayout>
      <div className="flex w-full flex-col items-start">
        <div className="flex w-full items-center gap-6 bg-gray-50 px-4 py-6 md:px-6">
          <div className="flex flex-1 flex-col items-start gap-2">
            <h1 className="text-lg font-semibold leading-[18px] text-card-foreground md:text-xl">
              360度評価進行フロー
            </h1>
            <p className="text-xs leading-4 text-foreground md:text-sm md:leading-5">
              管理者は、各タスクを期日までに完了させてください。
            </p>
          </div>
          <Button disabled className="hidden opacity-50 md:flex">
            次へ
          </Button>
        </div>

        <div className="flex flex-1 flex-col items-start gap-2.5 self-stretch bg-white p-6 pb-8 md:px-8 md:py-8">
          <div className="flex w-full flex-col items-start">
            {tasks.map((task, index) => (
              <TimelineItem
                key={task.id}
                task={task}
                isFirst={index === 0}
                isLast={index === tasks.length - 1}
              />
            ))}
          </div>
        </div>
      </div>
    </AppLayout>
  );
}
